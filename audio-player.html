<link rel="import" href="/bower_components/polymer/polymer.html">
<script src="js/drawbuffer.js"></script>
<script src="js/base64array.js"></script>

<polymer-element name="audio-player">
  <template>
    <canvas id="sound-buffer-view" width="750" height="200"></canvas>
  </template>
  <script>
    Polymer('audio-player', {
      ready: function() {
        AudioContext = webkitAudioContext;
        this.context = new AudioContext();
        this.source = this.context.createBufferSource();
        this.source.connect(this.context.destination);
      },
      play: function(audioData) {
        this.context.decodeAudioData(audioData.buffer, function(buffer) {
          this.source.buffer = buffer;
          this.source.start(0);
          this.drawBuffer(buffer);
        }.bind(this));
      },
      play64: function(base64AudioData) {
        this.play(base64DecToArr(base64AudioData));
      },
      stop: function() {
        this.source.stop(0);
      },
      drawBuffer: function(buffer) {
        var canvas = this.$['sound-buffer-view'];
        drawBuffer(canvas.width, canvas.height, canvas.getContext('2d'), buffer);
      }
    });
  </script>
</polymer-element>
